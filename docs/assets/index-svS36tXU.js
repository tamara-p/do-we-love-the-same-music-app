(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))t(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&t(c)}).observe(document,{childList:!0,subtree:!0});function a(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function t(r){if(r.ep)return;r.ep=!0;const o=a(r);fetch(r.href,o)}})();const i="c6f9a7985b2c489d98dda726138c1612";console.log("Client ID loaded:",i);const d=new URLSearchParams(window.location.search),s=d.get("code");if(!s)l(i);else{const e=await m(i,s),n=await f(e);g(n)}async function l(e){const n=u(128),a=await p(n);localStorage.setItem("verifier",n);const t=new URLSearchParams;t.append("client_id",e),t.append("response_type","code"),t.append("redirect_uri","https://tamara-p.github.io/do-we-love-the-same-music-app/"),t.append("scope","user-read-private user-read-email"),t.append("code_challenge_method","S256"),t.append("code_challenge",a),document.location=`https://accounts.spotify.com/authorize?${t.toString()}`}function u(e){let n="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let t=0;t<e;t++)n+=a.charAt(Math.floor(Math.random()*a.length));return n}async function p(e){const n=new TextEncoder().encode(e),a=await window.crypto.subtle.digest("SHA-256",n);return btoa(String.fromCharCode.apply(null,[...new Uint8Array(a)])).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function m(e,n){const a=localStorage.getItem("verifier"),t=new URLSearchParams;t.append("client_id",e),t.append("grant_type","authorization_code"),t.append("code",n),t.append("redirect_uri","https://tamara-p.github.io/do-we-love-the-same-music-app/"),t.append("code_verifier",a);const r=await fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:t}),{access_token:o}=await r.json();return o}async function f(e){return await(await fetch("https://api.spotify.com/v1/me",{method:"GET",headers:{Authorization:`Bearer ${e}`}})).json()}function g(e){if(document.getElementById("displayName").innerText=e.display_name,e.images[0]){const n=new Image(200,200);n.src=e.images[0].url,document.getElementById("avatar").appendChild(n)}document.getElementById("id").innerText=e.id,document.getElementById("email").innerText=e.email,document.getElementById("uri").innerText=e.uri,document.getElementById("uri").setAttribute("href",e.external_urls.spotify),document.getElementById("url").innerText=e.href,document.getElementById("url").setAttribute("href",e.href),document.getElementById("imgUrl").innerText=e.images[0]?.url??"(no profile image)"}
